<html>
  <title>CuBLE.js Test</title>
  <script src="../../node_modules/alg/dist/alg.js"></script>
  <script src="../../node_modules/kpuzzle/dist/kpuzzle.js"></script>
  <script src="../../dist/cuble.js"></script>
  <style>
  .svg-wrapper {
     max-width: 100px
  }
</style>
<body>
<button onclick="connectBluetooth()">Connect</button>
<button onclick="connectKeyboard()">Enable Keyboard Input</button>
<button onclick="reset()">Reset</button>
<span id="display"></span>
<br>
<span id="alg"></span>
<br>
<button onclick="start()">Start</button>
<button onclick="resume()">Resume</button>
<br>
<textarea id="log" rows=20 style="font-family: monospace; width: 80%"></textarea>
<script>
const {Sequence, algToString} = alg;
const {Puzzles, SVG} = kpuzzle;
const {connect, debugKeyboardConnect, enableDebugLogging} = cuble;

enableDebugLogging(true);

const def = Puzzles["333"];
const svg = new SVG(def);

function onMove(e) {
  document.querySelector("#alg").textContent += " " + algToString(new Sequence([e.latestMove]));
  svg.draw(def, e.state);
  // console.log(e);
}

// var running = null;
// function start() {
//   running = setInterval(display.bind(display, puzzles[0]), 1000)
// }

// function pause() {
//   clearInterval(running);
//   running = null;
// }

// async function display(puzzle) {
//   try {
//     const state = await puzzle.getState();
//     const l = document.querySelector("#log");
//     l.textContent = state.substring(0, 1000) + "\n" + l.textContent;
//   } catch(e) {
//     console.error(e)
//   }
// }

const puzzles = [];
async function connectBluetooth() {
  const puzzle = await connect();
  puzzle.addMoveListener(onMove);
  puzzles.push(puzzle);
  document.getElementById("display").appendChild(svg.element);
}

async function connectKeyboard() {
  const puzzle = await debugKeyboardConnect();
  puzzles.push(puzzle);
  puzzle.addMoveListener(onMove);
}

function reset() {
  document.querySelector("#alg").textContent = "";
}
</script>
</body>
</html>
